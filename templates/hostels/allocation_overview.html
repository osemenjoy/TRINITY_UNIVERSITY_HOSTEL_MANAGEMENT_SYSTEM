{% extends "base.html" %}

{% block title %}Allocation Overview - Trinity Hostel Management{% endblock %}

{% block content %}
<div class="page-header">
    <div class="row align-items-center">
        <div class="col">
            <h1><i class="bi bi-diagram-3"></i> Allocation Overview</h1>
            <p class="text-muted">View all room allocations and hostel occupancy statistics</p>
        </div>
    </div>
</div>

<!-- Occupancy Statistics -->
<div class="card mb-4">
    <div class="card-header">
        <i class="bi bi-bar-chart"></i> Hostel Occupancy
    </div>
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Hostel</th>
                    <th>Total Capacity</th>
                    <th>Occupied</th>
                    <th>Available</th>
                    <th>Occupancy Rate</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in hostel_stats %}
                    <tr>
                        <td><strong>{{ stat.hostel.name }}</strong></td>
                        <td>{{ stat.total_capacity }} beds</td>
                        <td>{{ stat.occupied }} beds</td>
                        <td>{{ stat.available }} beds</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar {% if stat.percentage >= 80 %}bg-danger{% elif stat.percentage >= 50 %}bg-warning{% else %}bg-success{% endif %}" 
                                     role="progressbar" 
                                     style="width: {{ stat.percentage }}%"
                                     aria-valuenow="{{ stat.percentage }}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="100">
                                    {{ stat.percentage }}%
                                </div>
                            </div>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">
                            <i class="bi bi-inbox"></i> No hostels configured
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Allocations Table -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="bi bi-people"></i> Student Allocations
            <span class="badge bg-primary float-end">{{ total_allocations }} allocated</span>
        </h5>
    </div>
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Student</th>
                    <th>Matric No.</th>
                    <th>Hostel</th>
                    <th>Floor</th>
                    <th>Room</th>
                    <th>Allocation Date</th>
                </tr>
            </thead>
            <tbody>
                {% if allocations %}
                    {% for allocation in allocations %}
                        <tr>
                            <td>
                                <strong>{{ allocation.student.user.get_full_name }}</strong>
                                <br>
                                <small class="text-muted">{{ allocation.student.get_gender_display }} | Level {{ allocation.student.level }}</small>
                            </td>
                            <td>{{ allocation.student.matric_no }}</td>
                            <td>
                                <span class="badge bg-primary">
                                    {{ allocation.room.floor.hostel.name }}
                                </span>
                            </td>
                            <td>{{ allocation.room.floor.get_floor_type_display }}</td>
                            <td>
                                <span class="badge bg-info">
                                    Room {{ allocation.room.room_number }}
                                </span>
                                <br>
                                <small class="text-muted">({{ allocation.room.current_occupancy }}/{{ allocation.room.capacity }})</small>
                            </td>
                            <td>{{ allocation.date_allocated|date:"M d, Y H:i" }}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            <i class="bi bi-inbox"></i> No allocations yet
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}
